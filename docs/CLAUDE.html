<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>CLAUDE.md ‚Ä¢ MOSAIC</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="favicon-96x96.png"><link rel="icon" type="‚Äùimage/svg+xml‚Äù" href="favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png"><link rel="icon" sizes="any" href="favicon.ico"><link rel="manifest" href="site.webmanifest"><script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="CLAUDE.md"><meta property="og:image" content="https://institutefordiseasemodeling.github.io/MOSAIC-pkg/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">MOSAIC</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.6.3</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="articles/Deployment.html">Deployment</a></li>
    <li><a class="dropdown-item" href="articles/Installation.html">Installation</a></li>
    <li><a class="dropdown-item" href="articles/Running-MOSAIC.html">Running MOSAIC</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/InstituteforDiseaseModeling/MOSAIC-pkg/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-title-body">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="logo.png" class="logo" alt=""><h1>CLAUDE.md</h1>
      <small class="dont-index">Source: <a href="https://github.com/InstituteforDiseaseModeling/MOSAIC-pkg/blob/HEAD/CLAUDE.md" class="external-link"><code>CLAUDE.md</code></a></small>
    </div>

<div id="claudemd" class="section level1">

<p>This file provides guidance to Claude Code (claude.ai/code) when working with the MOSAIC R package.</p>
<div class="section level2">
<h2 id="critical-file-creation-restrictions">CRITICAL FILE CREATION RESTRICTIONS<a class="anchor" aria-label="anchor" href="#critical-file-creation-restrictions"></a></h2>
<p><strong>IMPORTANT</strong>: MOSAIC-pkg is a standard R package that is sensitive to unwanted file additions. To maintain package integrity:</p>
<div class="section level3">
<h3 id="file-creation-rules">File Creation Rules<a class="anchor" aria-label="anchor" href="#file-creation-rules"></a></h3>
<ul><li>
<strong>NEVER</strong> create new files directly in the MOSAIC-pkg directory unless explicitly necessary for R package functionality</li>
<li>
<strong>ALWAYS</strong> use the <code>./claude/</code> directory for any temporary files, test outputs, or exploratory work</li>
<li>
<strong>EXCEPTIONS</strong>: Only create files in the following locations when necessary:
<ul><li>
<code>R/</code> - New R function files following naming conventions</li>
<li>
<code>tests/testthat/</code> - New test files</li>
<li>
<code>model/input/</code> or <code>model/output/</code> - Model-specific data files</li>
<li>Files explicitly requested by the user</li>
</ul></li>
</ul></div>
<div class="section level3">
<h3 id="working-directory-structure">Working Directory Structure<a class="anchor" aria-label="anchor" href="#working-directory-structure"></a></h3>
<pre><code>MOSAIC-pkg/
‚îú‚îÄ‚îÄ claude/           # USE THIS for all temporary/exploratory files
‚îú‚îÄ‚îÄ R/                # R functions only (follow naming conventions)
‚îú‚îÄ‚îÄ tests/testthat/   # Test files only
‚îú‚îÄ‚îÄ model/            # Model inputs/outputs only
‚îî‚îÄ‚îÄ ...               # Other standard R package directories</code></pre>
</div>
<div class="section level3">
<h3 id="claude-directory-file-naming-conventions">Claude Directory File Naming Conventions<a class="anchor" aria-label="anchor" href="#claude-directory-file-naming-conventions"></a></h3>
<ul><li>
<strong>Development plans</strong>: Use <code>plan_*.md</code> format (e.g., <code>plan_posterior_parameter_distributions.md</code>)</li>
<li>
<strong>Analysis reports</strong>: Descriptive names with context (e.g., <code>model_convergence_diagnostics_feedback.md</code>)</li>
<li>
<strong>Bug summaries</strong>: Include issue type (e.g., <code>na_bugs_summary.md</code>)</li>
<li>
<strong>Feature documentation</strong>: Clear descriptive names (e.g., <code>vaccination_maps_bug_fixes.md</code>)</li>
</ul><p><strong>Before creating any file</strong>, ask yourself: 1. Is this file essential for the R package functionality? 2. Has the user explicitly requested this file? 3. Can this be placed in <code>./claude/</code> instead?</p>
<p>If the answer to 1 or 2 is NO, place the file in <code>./claude/</code>.</p>
</div>
</div>
<div class="section level2">
<h2 id="r-package-structure">R Package Structure<a class="anchor" aria-label="anchor" href="#r-package-structure"></a></h2>
<p>This is a standard R package for the MOSAIC cholera transmission modeling framework. The package contains 100+ functions organized by purpose and integrates with external Python dependencies.</p>
</div>
<div class="section level2">
<h2 id="key-development-commands">Key Development Commands<a class="anchor" aria-label="anchor" href="#key-development-commands"></a></h2>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="co"># Package development</span></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a><span class="ex">R</span> CMD check .</span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a><span class="ex">R</span> CMD build .</span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a><span class="ex">R</span> CMD INSTALL MOSAIC_<span class="pp">*</span>.tar.gz</span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a><span class="co"># Testing</span></span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a><span class="ex">Rscript</span> <span class="at">-e</span> <span class="st">"library(testthat); test_check('MOSAIC')"</span></span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a><span class="ex">Rscript</span> <span class="at">-e</span> <span class="st">"testthat::test_file('tests/testthat/test-calc_log_likelihood_negbin.R')"</span></span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a><span class="ex">Rscript</span> <span class="at">-e</span> <span class="st">"devtools::test()"</span></span>
<span id="cb2-10"><a href="#cb2-10" tabindex="-1"></a><span class="ex">Rscript</span> <span class="at">-e</span> <span class="st">"devtools::check()"</span></span>
<span id="cb2-11"><a href="#cb2-11" tabindex="-1"></a><span class="ex">Rscript</span> <span class="at">-e</span> <span class="st">"covr::package_coverage()"</span></span>
<span id="cb2-12"><a href="#cb2-12" tabindex="-1"></a></span>
<span id="cb2-13"><a href="#cb2-13" tabindex="-1"></a><span class="co"># Model-specific testing</span></span>
<span id="cb2-14"><a href="#cb2-14" tabindex="-1"></a><span class="ex">Rscript</span> <span class="at">-e</span> <span class="st">"testthat::test_file('tests/testthat/test-calc_model_likelihood.R')"</span></span>
<span id="cb2-15"><a href="#cb2-15" tabindex="-1"></a></span>
<span id="cb2-16"><a href="#cb2-16" tabindex="-1"></a><span class="co"># Documentation</span></span>
<span id="cb2-17"><a href="#cb2-17" tabindex="-1"></a><span class="ex">Rscript</span> <span class="at">-e</span> <span class="st">"devtools::document()"</span></span>
<span id="cb2-18"><a href="#cb2-18" tabindex="-1"></a><span class="ex">Rscript</span> <span class="at">-e</span> <span class="st">"pkgdown::build_site()"</span></span>
<span id="cb2-19"><a href="#cb2-19" tabindex="-1"></a></span>
<span id="cb2-20"><a href="#cb2-20" tabindex="-1"></a><span class="co"># Python dependencies</span></span>
<span id="cb2-21"><a href="#cb2-21" tabindex="-1"></a><span class="ex">Rscript</span> <span class="at">-e</span> <span class="st">"MOSAIC::check_dependencies()"</span></span>
<span id="cb2-22"><a href="#cb2-22" tabindex="-1"></a><span class="ex">Rscript</span> <span class="at">-e</span> <span class="st">"MOSAIC::install_dependencies()"</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="function-development-guidelines">Function Development Guidelines<a class="anchor" aria-label="anchor" href="#function-development-guidelines"></a></h2>
<div class="section level3">
<h3 id="function-naming-conventions">Function Naming Conventions<a class="anchor" aria-label="anchor" href="#function-naming-conventions"></a></h3>
<ul><li>
<strong><code>process_*()</code></strong>: Data cleaning and preprocessing functions</li>
<li>
<strong><code>est_*()</code></strong>: Parameter estimation and modeling functions<br></li>
<li>
<strong><code>plot_*()</code></strong>: Visualization and figure generation functions</li>
<li>
<strong><code>get_*()</code></strong>: Data retrieval and utility functions</li>
<li>
<strong><code>calc_*()</code></strong>: Mathematical calculations and computations</li>
<li>
<strong><code>check_*()</code></strong>: Validation and verification functions</li>
</ul></div>
<div class="section level3">
<h3 id="adding-new-functions">Adding New Functions<a class="anchor" aria-label="anchor" href="#adding-new-functions"></a></h3>
<ul><li>Follow existing patterns in <code>R/</code> directory organization</li>
<li>All functions must be documented with roxygen2 comments</li>
<li>Add corresponding tests in <code>tests/testthat/test-[function-name].R</code>
</li>
<li>Update <code>NAMESPACE</code> will be auto-generated via roxygen2</li>
<li>Consider if function outputs should go to <code>../MOSAIC-docs/figures/</code> for documentation</li>
</ul></div>
<div class="section level3">
<h3 id="development-workflow-for-new-functions">Development Workflow for New Functions<a class="anchor" aria-label="anchor" href="#development-workflow-for-new-functions"></a></h3>
<ol style="list-style-type: decimal"><li>Create function file in <code>R/</code> following naming convention</li>
<li>Add roxygen2 documentation with examples</li>
<li>Run <code><a href="https://devtools.r-lib.org/reference/document.html" class="external-link">devtools::document()</a></code> to update documentation</li>
<li>Add unit tests in <code>tests/testthat/</code>
</li>
<li>Run <code><a href="https://devtools.r-lib.org/reference/test.html" class="external-link">devtools::test()</a></code> to verify tests pass</li>
<li>Update <code>model/LAUNCH.R</code> if function is part of main workflow</li>
</ol></div>
</div>
<div class="section level2">
<h2 id="function-organization">Function Organization<a class="anchor" aria-label="anchor" href="#function-organization"></a></h2>
<div class="section level3">
<h3 id="key-directories">Key Directories<a class="anchor" aria-label="anchor" href="#key-directories"></a></h3>
<ul><li>
<strong><code>R/</code></strong>: All function definitions (100+ files)</li>
<li>
<strong><code>data/</code></strong>: Package datasets (ISO codes, default configurations)</li>
<li>
<strong><code>tests/testthat/</code></strong>: Unit tests</li>
<li>
<strong><code>man/</code></strong>: Auto-generated documentation</li>
<li>
<strong><code>model/</code></strong>: Contains LAUNCH.R (main workflow) and input/output directories</li>
<li>
<strong><code>inst/extdata/</code></strong>: Default parameter files (JSON format)</li>
<li>
<strong><code>local/</code></strong>: Development and testing workspace</li>
<li>
<strong><code>azure/</code></strong>: Parallel execution scripts for scaling</li>
<li>
<strong><code>vignettes/articles/</code></strong>: Extended documentation and examples</li>
</ul></div>
</div>
<div class="section level2">
<h2 id="critical-dependencies">Critical Dependencies<a class="anchor" aria-label="anchor" href="#critical-dependencies"></a></h2>
<div class="section level3">
<h3 id="python-integration">Python Integration<a class="anchor" aria-label="anchor" href="#python-integration"></a></h3>
<ul><li>Uses <code>reticulate</code> to interface with <code>laser-cholera</code> Python package</li>
<li>Import pattern: <code>lc &lt;- reticulate::import("laser_cholera")</code>
</li>
<li>Model execution: <code>lc$metapop$model$run_model(paramfile, seed)</code>
</li>
</ul></div>
<div class="section level3">
<h3 id="system-dependencies">System Dependencies<a class="anchor" aria-label="anchor" href="#system-dependencies"></a></h3>
<ul><li>
<strong>Geospatial libraries</strong>: GDAL, PROJ, GEOS for spatial operations</li>
<li>
<strong>R packages</strong>: Extensive dependencies listed in DESCRIPTION</li>
<li>
<strong>reticulate configuration</strong>: For Python environment management</li>
<li>Use <code><a href="reference/check_dependencies.html">check_dependencies()</a></code> and <code><a href="reference/install_dependencies.html">install_dependencies()</a></code> for setup</li>
</ul></div>
<div class="section level3">
<h3 id="optional-dependencies">Optional Dependencies<a class="anchor" aria-label="anchor" href="#optional-dependencies"></a></h3>
<ul><li>
<strong>mobility package</strong>: Optional GitHub package for regenerating mobility estimates
<ul><li>Only needed if regenerating mobility data (most users won‚Äôt need this)</li>
<li>Requires JAGS (&gt;= 4.3.0) system installation</li>
<li>Pre-computed mobility files included in <code>model/input/</code>
</li>
<li>Install with: <code>remotes::install_github("COVID-19-Mobility-Data-Network/mobility")</code>
</li>
<li>Used by: <code><a href="reference/est_mobility.html">est_mobility()</a></code> function</li>
</ul></li>
</ul></div>
</div>
<div class="section level2">
<h2 id="laser-model-configuration">LASER Model Configuration<a class="anchor" aria-label="anchor" href="#laser-model-configuration"></a></h2>
<div class="section level3">
<h3 id="configuration-files">Configuration Files<a class="anchor" aria-label="anchor" href="#configuration-files"></a></h3>
<ul><li>Default configurations stored in <code>data/</code> as <code>.rda</code> files</li>
<li>JSON/YAML format for cross-language compatibility</li>
<li>Key configs: <code>config_default</code>, <code>config_simulation_endemic</code>, <code>config_simulation_epidemic</code>
</li>
<li>Parameter files in <code>inst/extdata/</code> provide JSON templates</li>
<li>Relationship between <code>inst/extdata/</code> parameter files and <code>data/</code> R objects</li>
</ul></div>
<div class="section level3">
<h3 id="model-execution-flow">Model Execution Flow<a class="anchor" aria-label="anchor" href="#model-execution-flow"></a></h3>
<ol style="list-style-type: decimal"><li>Create/modify configuration using <code><a href="reference/make_LASER_config.html">make_LASER_config()</a></code>
</li>
<li>Run model via <code>run_LASER_model()</code> or direct Python interface</li>
<li>Process results using <code><a href="reference/calc_model_likelihood.html">calc_model_likelihood()</a></code> and related functions</li>
</ol></div>
</div>
<div class="section level2">
<h2 id="data-processing-pipeline">Data Processing Pipeline<a class="anchor" aria-label="anchor" href="#data-processing-pipeline"></a></h2>
<div class="section level3">
<h3 id="input-data-sources">Input Data Sources<a class="anchor" aria-label="anchor" href="#input-data-sources"></a></h3>
<ul><li>Raw data from <code>../MOSAIC-data/raw/</code> (read-only)</li>
<li>Processed data from <code>../MOSAIC-data/processed/</code>
</li>
<li>External APIs: OpenMeteo, WHO dashboards</li>
</ul></div>
<div class="section level3">
<h3 id="processing-functions">Processing Functions<a class="anchor" aria-label="anchor" href="#processing-functions"></a></h3>
<ul><li>Climate data: <code><a href="reference/download_climate_data.html">download_climate_data()</a></code>, <code><a href="reference/process_climate_data.html">process_climate_data()</a></code>
</li>
<li>Cholera surveillance: <code><a href="reference/process_WHO_weekly_data.html">process_WHO_weekly_data()</a></code>, <code><a href="reference/process_cholera_surveillance_data.html">process_cholera_surveillance_data()</a></code>
</li>
<li>Demographics: <code><a href="reference/process_UN_demographics_data.html">process_UN_demographics_data()</a></code>, <code><a href="reference/est_demographic_rates.html">est_demographic_rates()</a></code>
</li>
<li>Vaccination: <code><a href="reference/process_WHO_vaccination_data.html">process_WHO_vaccination_data()</a></code>, <code><a href="reference/est_vaccination_rate.html">est_vaccination_rate()</a></code>
</li>
</ul></div>
</div>
<div class="section level2">
<h2 id="testing-guidelines">Testing Guidelines<a class="anchor" aria-label="anchor" href="#testing-guidelines"></a></h2>
<div class="section level3">
<h3 id="test-structure">Test Structure<a class="anchor" aria-label="anchor" href="#test-structure"></a></h3>
<ul><li>Tests organized by function type in <code>tests/testthat/</code>
</li>
<li>Focus on likelihood calculations, spatial operations, and parameter estimation</li>
<li>Test files follow pattern: <code>test-[function-name].R</code>
</li>
</ul></div>
<div class="section level3">
<h3 id="running-tests">Running Tests<a class="anchor" aria-label="anchor" href="#running-tests"></a></h3>
<div class="sourceCode" id="cb3"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="co"># All tests</span></span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a><span class="ex">Rscript</span> <span class="at">-e</span> <span class="st">"devtools::test()"</span></span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a><span class="co"># Specific test file</span></span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a><span class="ex">Rscript</span> <span class="at">-e</span> <span class="st">"testthat::test_file('tests/testthat/test-calc_spatial_correlation.R')"</span></span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a><span class="co"># Test coverage</span></span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a><span class="ex">Rscript</span> <span class="at">-e</span> <span class="st">"covr::package_coverage()"</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="common-development-patterns">Common Development Patterns<a class="anchor" aria-label="anchor" href="#common-development-patterns"></a></h2>
<div class="section level3">
<h3 id="path-management">Path Management<a class="anchor" aria-label="anchor" href="#path-management"></a></h3>
<ul><li>Use <code><a href="reference/set_root_directory.html">set_root_directory()</a></code> to establish project root</li>
<li>Access paths via <code>PATHS &lt;- get_paths()</code>
</li>
<li>All file operations use absolute paths from PATHS</li>
</ul></div>
<div class="section level3">
<h3 id="error-handling">Error Handling<a class="anchor" aria-label="anchor" href="#error-handling"></a></h3>
<ul><li>Extensive parameter validation in estimation functions</li>
<li>Graceful handling of missing data in processing functions</li>
<li>Clear error messages for configuration issues</li>
</ul></div>
<div class="section level3">
<h3 id="documentation">Documentation<a class="anchor" aria-label="anchor" href="#documentation"></a></h3>
<ul><li>All functions documented with roxygen2</li>
<li>Examples provided for key functions</li>
<li>Package documentation built with pkgdown</li>
</ul></div>
<div class="section level3">
<h3 id="npe-output-handling-performance-critical">NPE Output Handling (Performance Critical)<a class="anchor" aria-label="anchor" href="#npe-output-handling-performance-critical"></a></h3>
<p><strong>Background</strong>: During BFRS sampling, ~40K simulations generate individual <code>out_NNNNNNN.parquet</code> files containing time series data. Only 1-5% of these simulations receive non-zero NPE weights.</p>
<p><strong>Directory Structure</strong>:</p>
<pre><code>1_bfrs/
‚îú‚îÄ‚îÄ simulations.parquet          # Metadata (18 MB, all simulations)
‚îú‚îÄ‚îÄ convergence_results.parquet  # Convergence diagnostics
‚îú‚îÄ‚îÄ priors.json                  # Parameter priors
‚îî‚îÄ‚îÄ outputs/                     # Subdirectory for individual output files
    ‚îú‚îÄ‚îÄ out_0000001.parquet     # Simulation 1 time series
    ‚îú‚îÄ‚îÄ out_0000002.parquet     # Simulation 2 time series
    ‚îî‚îÄ‚îÄ ... (39,465 files)</code></pre>
<p><strong>Optimized Workflow</strong>: 1. <strong>During simulation</strong>: Individual output files created in <code>outputs/</code> subdirectory 2. <strong>After simulation</strong>: ISO codes mapped in-place to files in <code>outputs/</code> 3. <strong>During NPE training</strong>: <code>.prepare_npe_data()</code> loads only weighted simulation files from <code>outputs/</code> 4. <strong>After NPE completes</strong>: Entire <code>outputs/</code> directory removed to free disk space</p>
<p><strong>Key Points</strong>: - ‚ùå <strong>DO NOT</strong> combine individual files into <code>outputs.parquet</code> (this was removed - it created a 194 MB file just to filter to 2-5 MB) - ‚úÖ <strong>DO</strong> organize output files in <code>outputs/</code> subdirectory (avoids 39K+ files cluttering the main directory) - ‚úÖ <strong>DO</strong> keep individual files until NPE training completes - ‚úÖ Entire <code>outputs/</code> directory is automatically removed after NPE completes (frees 50-200 MB disk space) - üîß For debugging: Comment out cleanup section in calibration script if you need to preserve files</p>
<p><strong>Performance benefit</strong>: - Old approach: 30-120 seconds to load and filter 45M rows from combined file - New approach: 0.1-0.5 seconds to load only weighted simulation files - <strong>Speedup: 100-1200√ó faster (2-3 orders of magnitude)</strong></p>
<p><strong>Code locations</strong>: - Loading logic: <code>R/npe.R</code> in <code>.prepare_npe_data()</code> function (lines 893-896 for outputs/ path) - Calibration workflow: <code>local/calibration/calibration_test_17.R</code> - Directory structure: lines 111-117 - Output file creation: line 457 (writes to outputs/ subdirectory) - ISO mapping: lines 1077-1109 (reads from outputs/ subdirectory) - Cleanup: lines 2403-2423 (removes entire outputs/ directory)</p>
</div>
</div>
<div class="section level2">
<h2 id="integration-points">Integration Points<a class="anchor" aria-label="anchor" href="#integration-points"></a></h2>
<div class="section level3">
<h3 id="external-repositories">External Repositories<a class="anchor" aria-label="anchor" href="#external-repositories"></a></h3>
<ul><li>
<strong>laser-cholera</strong>: Core simulation engine (Python)</li>
<li>
<strong>MOSAIC-data</strong>: Data input/output</li>
<li>
<strong>MOSAIC-docs</strong>: Figure output destination</li>
</ul></div>
<div class="section level3">
<h3 id="key-integration-functions">Key Integration Functions<a class="anchor" aria-label="anchor" href="#key-integration-functions"></a></h3>
<ul><li>
<code>run_LASER_model()</code>: Main interface to Python simulation</li>
<li>
<code><a href="reference/calc_model_likelihood.html">calc_model_likelihood()</a></code>: Process simulation results</li>
<li>Plotting functions: Output to <code>../MOSAIC-docs/figures/</code>
</li>
<li>
<strong>Vignette workflow</strong>: <code>vignettes/articles/Running-MOSAIC.Rmd</code> shows direct laser-cholera integration</li>
<li>
<strong>Azure scaling</strong>: <code>azure/azure_run_laser.R</code> for parallel execution with command-line args</li>
</ul></div>
</div>
<div class="section level2">
<h2 id="common-pitfalls-and-troubleshooting">Common Pitfalls and Troubleshooting<a class="anchor" aria-label="anchor" href="#common-pitfalls-and-troubleshooting"></a></h2>
<ul><li>
<strong>Path setup is critical</strong>: <code><a href="reference/set_root_directory.html">set_root_directory()</a></code> must be called before <code><a href="reference/get_paths.html">get_paths()</a></code>
</li>
<li>
<strong>Python environment issues</strong>: Use <code>remove_MOSAIC_python_env()</code> for troubleshooting</li>
<li>
<strong>File naming typos</strong>: Note <code>make_defaut_LASER_config.R</code> (should be ‚Äúdefault‚Äù) and <code>processs_suitability_data.R</code> (extra ‚Äús‚Äù)</li>
<li>
<strong>Model workflow</strong>: <code>model/LAUNCH.R</code> contains the complete data processing and modeling pipeline</li>
</ul></div>
</div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://github.com/gilesjohnr" class="external-link">John R Giles</a>, <a href="https://github.com/ChristopherWLorton" class="external-link">Christopher W Lorton</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

