<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Estimate Environmental Suitability (psi) for Cholera Transmission — est_suitability • MOSAIC</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Estimate Environmental Suitability (psi) for Cholera Transmission — est_suitability"><meta name="description" content="This function loads climate data, ENSO data, and weekly cholera cases data to estimate the environmental
suitability for cholera transmission based on various environmental factors. It scales the climate
covariates and then fits an LSTM-based RNN model to predict cholera outbreaks. The model is trained
using past cholera case data and climate conditions, and predictions are made for environmental
suitability (psi) based on the climate covariates."><meta property="og:description" content="This function loads climate data, ENSO data, and weekly cholera cases data to estimate the environmental
suitability for cholera transmission based on various environmental factors. It scales the climate
covariates and then fits an LSTM-based RNN model to predict cholera outbreaks. The model is trained
using past cholera case data and climate conditions, and predictions are made for environmental
suitability (psi) based on the climate covariates."><meta property="og:image" content="https://institutefordiseasemodeling.github.io/MOSAIC-pkg/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">MOSAIC</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.6.3</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/Deployment.html">Deployment</a></li>
    <li><a class="dropdown-item" href="../articles/Installation.html">Installation</a></li>
    <li><a class="dropdown-item" href="../articles/Running-MOSAIC.html">Running MOSAIC</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/InstituteforDiseaseModeling/MOSAIC-pkg/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Estimate Environmental Suitability (psi) for Cholera Transmission</h1>
      <small class="dont-index">Source: <a href="https://github.com/InstituteforDiseaseModeling/MOSAIC-pkg/blob/HEAD/R/est_suitability.R" class="external-link"><code>R/est_suitability.R</code></a></small>
      <div class="d-none name"><code>est_suitability.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function loads climate data, ENSO data, and weekly cholera cases data to estimate the environmental
suitability for cholera transmission based on various environmental factors. It scales the climate
covariates and then fits an LSTM-based RNN model to predict cholera outbreaks. The model is trained
using past cholera case data and climate conditions, and predictions are made for environmental
suitability (psi) based on the climate covariates.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">est_suitability</span><span class="op">(</span></span>
<span>  <span class="va">PATHS</span>,</span>
<span>  fit_date_start <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  fit_date_stop <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  pred_date_start <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  pred_date_stop <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  n_splits <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  seed_base <span class="op">=</span> <span class="fl">99</span>,</span>
<span>  fine_tune_epochs <span class="op">=</span> <span class="fl">12</span>,</span>
<span>  fine_tune_lr <span class="op">=</span> <span class="fl">0.001</span>,</span>
<span>  split_method <span class="op">=</span> <span class="st">"random"</span>,</span>
<span>  train_prop <span class="op">=</span> <span class="fl">0.6</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-paths">PATHS<a class="anchor" aria-label="anchor" href="#arg-paths"></a></dt>
<dd><p>A list containing paths where the data is stored. Typically generated by the <code><a href="get_paths.html">get_paths()</a></code> function and should include:</p><ul><li><p><strong>DATA_CHOLERA_WEEKLY</strong>: Path to the directory containing processed combined weekly cholera cases data (WHO+JHU+SUPP sources).</p></li>
<li><p><strong>DATA_ELEVATION</strong>: Path to the directory where elevation data is stored.</p></li>
<li><p><strong>MODEL_INPUT</strong>: Path to save the processed model inputs and outputs.</p></li>
<li><p><strong>DOCS_FIGURES</strong>: Path to save the generated plots.</p></li>
</ul></dd>


<dt id="arg-fit-date-start">fit_date_start<a class="anchor" aria-label="anchor" href="#arg-fit-date-start"></a></dt>
<dd><p>Date string or NULL. Start date for model fitting period. If NULL, auto-detects from first cholera case data.</p></dd>


<dt id="arg-fit-date-stop">fit_date_stop<a class="anchor" aria-label="anchor" href="#arg-fit-date-stop"></a></dt>
<dd><p>Date string or NULL. End date for model fitting period. If NULL, auto-detects from last date with both cholera cases and complete ENSO data.</p></dd>


<dt id="arg-pred-date-start">pred_date_start<a class="anchor" aria-label="anchor" href="#arg-pred-date-start"></a></dt>
<dd><p>Date string or NULL. Start date for prediction period. If NULL, uses fit_date_start.</p></dd>


<dt id="arg-pred-date-stop">pred_date_stop<a class="anchor" aria-label="anchor" href="#arg-pred-date-stop"></a></dt>
<dd><p>Date string or NULL. End date for prediction period. If NULL, auto-detects from last date with complete ENSO data.</p></dd>


<dt id="arg-n-splits">n_splits<a class="anchor" aria-label="anchor" href="#arg-n-splits"></a></dt>
<dd><p>Integer. Number of sequential random train/test splits for transfer learning. Default 1 (no fine-tuning).</p></dd>


<dt id="arg-seed-base">seed_base<a class="anchor" aria-label="anchor" href="#arg-seed-base"></a></dt>
<dd><p>Integer. Base seed for reproducible random splits. Each split uses seed_base + split_number.</p></dd>


<dt id="arg-fine-tune-epochs">fine_tune_epochs<a class="anchor" aria-label="anchor" href="#arg-fine-tune-epochs"></a></dt>
<dd><p>Integer. Number of epochs for fine-tuning on additional splits. Default 10.</p></dd>


<dt id="arg-fine-tune-lr">fine_tune_lr<a class="anchor" aria-label="anchor" href="#arg-fine-tune-lr"></a></dt>
<dd><p>Numeric. Lower learning rate for fine-tuning additional splits. Default 0.00001.</p></dd>


<dt id="arg-split-method">split_method<a class="anchor" aria-label="anchor" href="#arg-split-method"></a></dt>
<dd><p>Character. Method for train/validation splitting: "random" (default) or "location_month_block".
The "location_month_block" method groups sequences by country-month and randomly assigns entire blocks,
which better tests spatial-temporal generalization by preventing data leakage within location-months.</p></dd>


<dt id="arg-train-prop">train_prop<a class="anchor" aria-label="anchor" href="#arg-train-prop"></a></dt>
<dd><p>Numeric. Proportion of data for training in initial split (default 0.6). Used for both splitting methods.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>This function processes climate and cholera case data, fits an LSTM model, makes predictions on
environmental suitability (psi), and saves both the predictions and covariate data. It also
generates a plot showing the model fit (MAE and loss over training epochs) and saves it to a
specified directory.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The function performs the following steps:</p><ul><li><p>Loads processed climate and cholera data.</p></li>
<li><p>Determines appropriate date ranges for fitting and prediction based on data availability.</p></li>
<li><p>Validates data completeness within specified date ranges.</p></li>
<li><p>Scales the climate covariates using training data statistics.</p></li>
<li><p>Splits the training data into training and validation sets using either random sampling or location-month blocking.</p></li>
<li><p>Creates temporal LSTM sequences respecting country boundaries and temporal gaps.</p></li>
<li><p>Builds an LSTM-based recurrent neural network (RNN) model for predicting cholera outbreaks.</p></li>
<li><p>Trains the model on the training set and evaluates performance on the validation set.</p></li>
<li><p>Makes predictions on the full prediction period dataset.</p></li>
<li><p>Applies temporal smoothing to predictions and saves results to specified directories.</p></li>
<li><p>Optional: Performs sequential fine-tuning on additional random splits for transfer learning.</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="note">Note<a class="anchor" aria-label="anchor" href="#note"></a></h2>
    <p>The LSTM model uses climate variables to predict cholera suitability. The model's predictions are saved as
a CSV file and a plot showing the model fit (MAE and loss) is generated.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code>layer_lstm</code>, <code>fit</code>, <code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="co"># Set up paths</span></span></span>
<span class="r-in"><span><span class="va">PATHS</span> <span class="op">&lt;-</span> <span class="fu"><a href="get_paths.html">get_paths</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Basic usage with default settings</span></span></span>
<span class="r-in"><span><span class="fu">est_suitability</span><span class="op">(</span><span class="va">PATHS</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Custom date ranges for fitting and prediction</span></span></span>
<span class="r-in"><span><span class="fu">est_suitability</span><span class="op">(</span><span class="va">PATHS</span>,</span></span>
<span class="r-in"><span>               fit_date_start <span class="op">=</span> <span class="st">"2015-01-01"</span>,</span></span>
<span class="r-in"><span>               fit_date_stop <span class="op">=</span> <span class="st">"2023-12-31"</span>,</span></span>
<span class="r-in"><span>               pred_date_start <span class="op">=</span> <span class="st">"2020-01-01"</span>,</span></span>
<span class="r-in"><span>               pred_date_stop <span class="op">=</span> <span class="st">"2025-12-31"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Transfer learning with sequential fine-tuning on 3 random splits</span></span></span>
<span class="r-in"><span><span class="fu">est_suitability</span><span class="op">(</span><span class="va">PATHS</span>,</span></span>
<span class="r-in"><span>               n_splits <span class="op">=</span> <span class="fl">3</span>,</span></span>
<span class="r-in"><span>               seed_base <span class="op">=</span> <span class="fl">123</span>,</span></span>
<span class="r-in"><span>               fine_tune_epochs <span class="op">=</span> <span class="fl">15</span>,</span></span>
<span class="r-in"><span>               fine_tune_lr <span class="op">=</span> <span class="fl">0.00003</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Use location-month blocking for better spatial-temporal generalization</span></span></span>
<span class="r-in"><span><span class="fu">est_suitability</span><span class="op">(</span><span class="va">PATHS</span>,</span></span>
<span class="r-in"><span>               split_method <span class="op">=</span> <span class="st">"location_month_block"</span>,</span></span>
<span class="r-in"><span>               train_prop <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Location-month blocking with transfer learning</span></span></span>
<span class="r-in"><span><span class="fu">est_suitability</span><span class="op">(</span><span class="va">PATHS</span>,</span></span>
<span class="r-in"><span>               split_method <span class="op">=</span> <span class="st">"location_month_block"</span>,</span></span>
<span class="r-in"><span>               n_splits <span class="op">=</span> <span class="fl">5</span>,</span></span>
<span class="r-in"><span>               train_prop <span class="op">=</span> <span class="fl">0.6</span>,</span></span>
<span class="r-in"><span>               seed_base <span class="op">=</span> <span class="fl">42</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="co"># Basic usage with auto-detected date ranges</span></span></span>
<span class="r-in"><span><span class="fu">est_suitability</span><span class="op">(</span><span class="va">PATHS</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Historical validation: fit on 2010-2020, predict on 2021-2023</span></span></span>
<span class="r-in"><span><span class="fu">est_suitability</span><span class="op">(</span><span class="va">PATHS</span>,</span></span>
<span class="r-in"><span>                fit_date_start <span class="op">=</span> <span class="st">"2010-01-01"</span>,</span></span>
<span class="r-in"><span>                fit_date_stop <span class="op">=</span> <span class="st">"2020-12-31"</span>,</span></span>
<span class="r-in"><span>                pred_date_start <span class="op">=</span> <span class="st">"2021-01-01"</span>,</span></span>
<span class="r-in"><span>                pred_date_stop <span class="op">=</span> <span class="st">"2023-12-31"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://github.com/gilesjohnr" class="external-link">John R Giles</a>, <a href="https://github.com/ChristopherWLorton" class="external-link">Christopher W Lorton</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

