% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/calc_model_convergence.R
\name{calc_model_convergence}
\alias{calc_model_convergence}
\title{Calculate convergence diagnostics and write to files}
\usage{
calc_model_convergence(
  PATHS,
  results,
  output_dir,
  delta_max = 6,
  temperature = 1,
  ess_min = 1000,
  A_min = 0.75,
  cvw_max = 1,
  B_min = 2,
  max_w_max = 0.5,
  verbose = TRUE
)
}
\arguments{
\item{PATHS}{MOSAIC paths object from \code{get_paths()}.}

\item{results}{Data frame with columns: sim, seed, likelihood (and optionally others).}

\item{output_dir}{Character string specifying directory to write output files.}

\item{delta_max}{Numeric Δ cutoff used for truncation (default \code{6}).}

\item{temperature}{Positive scalar temperature for weight scaling (default \code{1}).
See \code{\link[=calc_model_akaike_weights]{calc_model_akaike_weights()}} for guidance.}

\item{ess_min}{Numeric target minimum effective sample size (ESS; default \code{1000}).}

\item{A_min}{Numeric target minimum agreement index (default \code{0.75}).}

\item{cvw_max}{Numeric target maximum coefficient of variation of weights (default \code{1.0}).}

\item{B_min}{Integer target minimum retained set size \eqn{B} (default \code{2}).}

\item{max_w_max}{Numeric in (0, 1] for the maximum allowed normalized weight (default \code{0.5}).}

\item{verbose}{Logical indicating whether to print progress messages (default \code{TRUE}).}
}
\value{
A list with summary information:
\itemize{
\item \code{status} — Overall convergence status ("PASS", "WARN", "FAIL")
\item \code{n_total} — Total number of simulations
\item \code{n_successful} — Number of successful simulations (finite likelihood)
\item \code{n_retained} — Number of simulations in retained set
\item \code{files_written} — Vector of output file names
}
}
\description{
Calculates model-weight agreement diagnostics from calibration results and writes
both per-simulation data (Parquet) and aggregate diagnostics (JSON) to files.
This function measures \strong{model-weight agreement} and \strong{evidence concentration},
not MCMC convergence.
}
\section{Important Note}{

This function measures \strong{model-weight agreement} and \strong{evidence concentration},
not MCMC convergence. For MCMC diagnostics, use R-hat, effective sample size from chains,
trace plots, etc. The "convergence" terminology here refers to agreement across the
ensemble of parameter draws, not chain convergence.
}

\section{File Outputs}{

The function writes two files to the output directory:
\itemize{
\item \code{convergence_results.parquet} — Per-simulation data with columns:
sim, seed, likelihood, aic, delta_aic, w, w_tilde, retained
\item \code{convergence_diagnostics.json} — Aggregate metrics with human-readable
descriptions, targets, and pass/fail status
}
}

\examples{
\dontrun{
# Prepare results data frame
results <- data.frame(
  sim = 1:1000,
  seed = 1001:2000,
  likelihood = 1500 + rnorm(1000, sd = 3)
)

# Calculate convergence and write files
summary <- calc_model_convergence(
  PATHS = get_paths(),
  results = results,
  output_dir = "path/to/output",
  temperature = 1.5
)

print(summary)
}

}
\seealso{
\code{\link[=plot_model_convergence]{plot_model_convergence()}},
\code{\link[=calc_model_aic_delta]{calc_model_aic_delta()}},
\code{\link[=calc_model_akaike_weights]{calc_model_akaike_weights()}}

Other calibration-metrics: 
\code{\link{calc_convergence_diagnostics}()},
\code{\link{calc_model_agreement_index}()},
\code{\link{calc_model_aic_delta}()},
\code{\link{calc_model_akaike_weights}()},
\code{\link{calc_model_cvw}()},
\code{\link{calc_model_ess}()},
\code{\link{calc_model_max_weight}()},
\code{\link{plot_model_convergence}()}
}
\concept{calibration-metrics}
