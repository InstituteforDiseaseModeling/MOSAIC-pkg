% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/calc_model_cor.R
\name{calc_model_cor}
\alias{calc_model_cor}
\title{Pearson (or Rank) Correlation Between Observed and Estimated Series}
\usage{
calc_model_cor(
  observed,
  estimated,
  method = c("pearson", "spearman", "kendall"),
  na_rm = TRUE,
  finite_only = TRUE,
  weights = NULL,
  verbose = FALSE
)
}
\arguments{
\item{observed}{A numeric vector or matrix of observed values.}

\item{estimated}{A numeric vector or matrix of model-estimated values
of the same length (after flattening) as \code{observed}.}

\item{method}{Correlation type. One of \code{"pearson"} (default),
\code{"spearman"}, or \code{"kendall"}.}

\item{na_rm}{Logical; if \code{TRUE} (default), remove any pair with
\code{NA}. If \code{FALSE} and any \code{NA}/\code{Inf} are found (or lengths
mismatch), returns \code{NA_real_}.}

\item{finite_only}{Logical; if \code{TRUE} (default), also drop non-finite
values (\code{Inf}, \code{-Inf}, \code{NaN}) during pairwise filtering.}

\item{weights}{Optional numeric vector of non-negative weights (recycled if
length 1). Only used when \code{method = "pearson"}; ignored otherwise.}

\item{verbose}{Logical; if \code{TRUE}, emit brief diagnostic messages.}
}
\value{
A single numeric value: the correlation coefficient for the chosen
\code{method}. Returns \code{NA_real_} if fewer than two valid pairs remain
or if a variance term is zero.
}
\description{
Computes the correlation between an observed series and a model-estimated
series. By default this is \strong{Pearson's correlation}. Inputs may be numeric
vectors or matrices; values are flattened and compared \strong{pairwise}. An
optional set of non-negative weights can be supplied for a \strong{weighted Pearson
correlation}.
}
\details{
After removing invalid pairs (see \code{na_rm} and \code{finite_only}), the
\strong{weighted Pearson correlation} is:
\deqn{
r_w \;=\; \frac{\sum_i w_i (x_i - \bar{x}_w) (y_i - \bar{y}_w)}{
           \sqrt{\sum_i w_i (x_i - \bar{x}_w)^2}\;
           \sqrt{\sum_i w_i (y_i - \bar{y}_w)^2}},
}
where \eqn{\bar{x}_w = \frac{\sum_i w_i x_i}{\sum_i w_i}} and similarly for
\eqn{\bar{y}_w}. If \code{weights = NULL}, the standard (unweighted) Pearson
correlation is returned. For \code{method = "spearman"} or \code{"kendall"},
any provided \code{weights} are \strong{ignored}.
}
\section{Input shapes}{

Vectors and matrices are supported. Matrices are flattened (column-major)
in both \code{observed} and \code{estimated} before pairwise comparison.
}

\examples{
# Vector example
set.seed(2)
y  <- rpois(20, 10)
yh <- y + rnorm(20, 0, 2)
calc_model_cor(y, yh)                   # Pearson (default)
calc_model_cor(y, yh, method = "spearman")

# Matrix example
Y  <- matrix(rpois(30, 5), nrow = 3)
Yh <- Y + matrix(rnorm(30, 0, 1), nrow = 3)
calc_model_cor(Y, Yh)

# Weighted Pearson (e.g., emphasize recent weeks)
w <- rep(seq(0.5, 1.5, length.out = ncol(Y)), each = nrow(Y))
calc_model_cor(Y, Yh, weights = w)

}
\seealso{
\code{\link[=calc_model_mse]{calc_model_mse()}}, \code{\link[=calc_model_likelihood]{calc_model_likelihood()}}, \code{\link[=calc_model_ppc]{calc_model_ppc()}}
}
