% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/npe_funcs.R
\name{calc_npe_coverage_diagnostics}
\alias{calc_npe_coverage_diagnostics}
\title{Calculate Coverage Diagnostics for NPE Models}
\usage{
calc_npe_coverage_diagnostics(
  npe_model_dir,
  test_data_dir = NULL,
  n_samples = 1024,
  n_test_cases = 100,
  output_file = NULL,
  verbose = TRUE,
  seed = 42
)
}
\arguments{
\item{npe_model_dir}{Directory containing trained NPE model files}

\item{test_data_dir}{Directory containing test dataset (simulations.parquet and outputs.parquet)}

\item{n_samples}{Number of samples to draw from posterior for each test case (default: 1024)}

\item{n_test_cases}{Maximum number of test cases to evaluate (default: 100)}

\item{output_file}{Optional path to save coverage results as CSV (default: NULL)}

\item{verbose}{Logical; print progress messages (default: TRUE)}

\item{seed}{Random seed for reproducibility (default: 42)}
}
\value{
List containing:
\describe{
\item{levels}{Vector of credible levels}
\item{coverages}{Vector of empirical coverage rates}
\item{n_test_cases}{Number of test cases used}
\item{coverage_rmse}{Root mean squared error between expected and observed coverage}
\item{is_well_calibrated}{Logical indicating if model is well-calibrated (RMSE < 0.05)}
}
}
\description{
Calculates expected coverage diagnostics for trained NPE models using lampe's
expected_coverage_mc function. This helps validate that the posterior estimator
is well-calibrated by checking if credible intervals contain the true parameters
at the expected rates.
}
\details{
This function loads a trained NPE model and evaluates its calibration by:
\enumerate{
\item Loading test data (parameter-observation pairs)
\item For each test case, sampling from the posterior given the observation
\item Computing the proportion of posterior samples with higher density than the true parameter
\item Checking if this proportion matches expected coverage rates
}

A well-calibrated posterior should have empirical coverage rates that match
the nominal credible levels (e.g., 95\% intervals should contain true parameters 95\% of the time).
}
\examples{
\dontrun{
# Calculate coverage diagnostics for trained NPE model
coverage_results <- calc_npe_coverage_diagnostics(
  npe_model_dir = "./results/npe",
  test_data_dir = "./results/test",
  n_samples = 1024,
  n_test_cases = 50
)

print(coverage_results$coverage_rmse)  # Should be < 0.05 for well-calibrated model
}

}
