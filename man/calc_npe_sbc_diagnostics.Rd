% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/npe_funcs.R
\name{calc_npe_sbc_diagnostics}
\alias{calc_npe_sbc_diagnostics}
\title{Simulation-Based Calibration (SBC) Diagnostics for NPE Models}
\usage{
calc_npe_sbc_diagnostics(
  npe_model_dir,
  priors_file,
  n_sbc_samples = 100,
  n_posterior_samples = 1000,
  output_dir = NULL,
  use_observed_data = FALSE,
  verbose = TRUE,
  seed = 42
)
}
\arguments{
\item{npe_model_dir}{Directory containing trained NPE model files}

\item{priors_file}{Path to priors.json file for generating test parameters}

\item{n_sbc_samples}{Number of SBC test cases to generate (default: 100)}

\item{n_posterior_samples}{Number of posterior samples per test case (default: 1000)}

\item{output_dir}{Directory to save SBC results and plots (default: same as npe_model_dir)}

\item{use_observed_data}{Logical; use observed data format instead of simulated (default: FALSE)}

\item{verbose}{Logical; print progress messages (default: TRUE)}

\item{seed}{Random seed for reproducibility (default: 42)}
}
\value{
List containing:
\describe{
\item{sbc_results}{Data frame with rank statistics for each parameter}
\item{sbc_p_values}{P-values from uniformity tests for each parameter}
\item{overall_calibration}{Overall calibration assessment}
\item{problematic_parameters}{Parameters that fail SBC tests}
\item{sbc_plot}{ggplot2 object showing SBC histograms}
}
}
\description{
Performs simulation-based calibration to validate NPE posterior inference
by generating data from the prior predictive distribution and checking if
the posterior correctly recovers the true parameters. This is the gold
standard for validating Bayesian inference procedures.
}
\details{
Simulation-based calibration works by:
\enumerate{
\item Drawing true parameters θ* from the prior
\item Simulating data x* ~ p(x|θ*) using the forward model
\item Computing posterior samples θ₁,...,θₙ ~ p(θ|x*) using NPE
\item Computing the rank of θ* among {θ₁,...,θₙ,θ*}
\item Checking if ranks are uniformly distributed across parameters
}

Well-calibrated posteriors should produce uniform rank distributions.
Deviations from uniformity indicate problems with the posterior inference.
}
\examples{
\dontrun{
# Run SBC diagnostics on trained NPE model
sbc_results <- calc_npe_sbc_diagnostics(
  npe_model_dir = "./results/npe",
  priors_file = "./config/priors.json",
  n_sbc_samples = 50,
  n_posterior_samples = 1000
)

# Check overall calibration
print(sbc_results$overall_calibration)

# Display SBC plot
print(sbc_results$sbc_plot)
}

}
