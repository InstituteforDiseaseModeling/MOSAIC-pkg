% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/npe_funcs.R
\name{calc_npe_spec}
\alias{calc_npe_spec}
\title{Calculate NPE Architecture Specification for MOSAIC Models}
\usage{
calc_npe_spec(
  n_sims,
  n_params,
  n_timesteps = NULL,
  n_locations = NULL,
  tier = NULL,
  preset = NULL,
  device = "cpu",
  verbose = TRUE
)
}
\arguments{
\item{n_sims}{Integer, number of training simulations available. Used to determine
data regime and select appropriate regularization.}

\item{n_params}{Integer, number of parameters to estimate. Affects network capacity
and embedding dimensions.}

\item{n_timesteps}{Integer, number of time points in data series (optional).
When provided, optimizes temporal processing components.}

\item{n_locations}{Integer, number of spatial locations (optional).
Influences spatial embedding and attention mechanisms.}

\item{tier}{Character string to override automatic tier selection. Options:
\code{"tiny", "small", "medium", "large", "xlarge"}. If NULL (default),
automatically determined from data characteristics.}

\item{preset}{Character string for predefined architecture configurations:
\itemize{
\item \code{"epidemic_small"} — Optimized for small outbreak datasets
\item \code{"epidemic_large"} — Designed for large epidemic time series
\item \code{"endemic"} — Tuned for endemic transmission patterns
}}

\item{device}{Character string specifying computing device:
\code{"cpu", "cuda", "mps"}. Default is "cpu".}

\item{verbose}{Logical indicating whether to print architecture details.
Default is TRUE.}
}
\value{
Named list containing complete NPE architecture specification with components:
\itemize{
\item \code{tier} — Selected architecture tier
\item \code{embedding} — Time series embedding configuration
\item \code{flow} — Normalizing flow parameters
\item \code{training} — Training hyperparameters
\item \code{device} — Target computing device
\item \code{architecture_type} — Summary of architecture choices
}
}
\description{
Dynamically determines optimal Neural Posterior Estimator architecture based on
data characteristics and complexity. Used internally by \code{\link{train_npe}}
to automatically configure neural network architectures for different problem scales.
}
\details{
The function implements a tiered architecture system that scales with problem complexity:

\strong{Tier Selection Criteria:}
\itemize{
\item \strong{Tiny}: < 1K simulations, < 10 parameters
\item \strong{Small}: < 5K simulations, < 25 parameters
\item \strong{Medium}: < 20K simulations, < 50 parameters
\item \strong{Large}: < 100K simulations, < 100 parameters
\item \strong{XLarge}: >= 100K simulations, >= 100 parameters
}

\strong{Architecture Components:}
\itemize{
\item \strong{Embedding Network}: Temporal Convolutional Networks (TCN) with
attention mechanisms for processing time series data
\item \strong{Normalizing Flows}: Neural Spline Flows for flexible posterior
approximation with appropriate transform depth
\item \strong{Training Setup}: Batch sizes, learning rates, and regularization
adapted to data regime
}

Internal helper functions:
\itemize{
\item \code{\link{.calc_tcn_blocks}} — Determines temporal receptive field
\item \code{\link{.pick_valid_attention_heads}} — Validates attention configuration
}
}
\section{External Dependencies}{

Architecture specifications are designed for:
\itemize{
\item \strong{Lampe}: NPE implementation framework (\url{https://github.com/probabilists/lampe})
\item \strong{PyTorch}: Neural network backend (\url{https://pytorch.org/})
\item \strong{Zuko}: Normalizing flows library (\url{https://github.com/probabilists/zuko})
}
}

\examples{
\dontrun{
# Calculate specification for medium-scale problem
spec <- calc_npe_spec(
  n_sims = 10000,
  n_params = 25,
  n_timesteps = 104,  # 2 years of weekly data
  n_locations = 3,
  device = "cuda",
  verbose = TRUE
)

# Use epidemic preset
spec_preset <- calc_npe_spec(
  n_sims = 5000,
  n_params = 15,
  preset = "epidemic_small"
)
}

}
\seealso{
\itemize{
\item \code{\link{train_npe}} for using the architecture specification
\item \code{\link{.calc_tcn_blocks}} for temporal complexity calculation
\item \code{\link{.pick_valid_attention_heads}} for attention head validation
}
}
