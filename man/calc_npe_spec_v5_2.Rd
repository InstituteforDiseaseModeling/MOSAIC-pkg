% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/npe_architecture_v5_2.R
\name{calc_npe_spec_v5_2}
\alias{calc_npe_spec_v5_2}
\title{Calculate NPE Architecture Specification for MOSAIC Models (Enhanced v5.2)}
\usage{
calc_npe_spec_v5_2(
  n_sims,
  n_params,
  n_timesteps = NULL,
  n_locations = NULL,
  tier = NULL,
  preset = NULL,
  flow_complexity = "auto",
  transforms_ramp = list(enabled = TRUE, per_params = 25, start_at = 50, cap = 20),
  heads_min_for_largeJ = 8,
  heads_J_threshold = 25,
  t_long_threshold = 700,
  tcn_blocks_floor_longT = 7,
  tcn_longT_multiplier = 1.2,
  gradient_clip_value = 1,
  scheduler_patience = 15,
  device = "cpu",
  verbose = TRUE
)
}
\arguments{
\item{n_sims}{Integer, number of training simulations available. Used to determine
data regime and select appropriate regularization.}

\item{n_params}{Integer, number of parameters to estimate. Affects network capacity
and embedding dimensions.}

\item{n_timesteps}{Integer, number of time points in data series (optional).
When provided, optimizes temporal processing components.}

\item{n_locations}{Integer, number of spatial locations (optional).
Influences spatial embedding and attention mechanisms.}

\item{tier}{Character string to override automatic tier selection. Options:
\code{"tiny", "small", "medium", "large", "xlarge"}. If NULL (default),
automatically determined from data characteristics.}

\item{preset}{Character string for predefined architecture configurations.}

\item{flow_complexity}{Character. One of "auto", "high", "max".
"high" adds +2 transforms and +2 bins to the auto choice.
"max" sets transforms/bins to the upper safe caps for the tier.}

\item{transforms_ramp}{List controlling depth scaling with parameter count.
Default ramp adds +1 transform for every 25 parameters beyond 50, capped at 20.}

\item{heads_min_for_largeJ}{Integer. Minimum attention heads when J >= heads_J_threshold.}

\item{heads_J_threshold}{Integer. Default 25. Threshold for large J guard.}

\item{t_long_threshold}{Integer. Default 700. When T > threshold, triggers long-T guard.}

\item{tcn_blocks_floor_longT}{Integer. Default 7. Minimum TCN blocks for long sequences.}

\item{tcn_longT_multiplier}{Numeric. Default 1.2. Channel multiplier for long sequences.}

\item{gradient_clip_value}{Numeric. Max gradient norm (L2). Default 1.0.}

\item{scheduler_patience}{Integer. Plateau scheduler patience (epochs). Default 15.}

\item{device}{Character string specifying computing device.}

\item{verbose}{Logical indicating whether to print architecture details.}
}
\value{
Named list containing complete NPE architecture specification with:
\itemize{
\item \code{tier} — Selected architecture tier
\item \code{embedding} — Time series embedding configuration
\item \code{flow} — Normalizing flow parameters
\item \code{training} — Training hyperparameters
\item \code{optimization} — Optimizer settings including gradient clipping
\item \code{device} — Target computing device
\item \code{rationale} — Detailed reasoning for all architecture decisions
}
}
\description{
Dynamically determines optimal Neural Posterior Estimator architecture based on
data characteristics and complexity with advanced capacity controls, automatic
guards for extreme conditions, and rationale tracking.
}
\section{Capacity Controls}{

The transform ramp provides smooth scaling with parameter count, adding +1 transform
for every 25 parameters beyond 50. This prevents under-capacity in the critical
50-100 parameter range where many models fall.
}

\section{Long T / Large J Guards}{

Long sequences (T>700) trigger increased TCN blocks and channels to ensure adequate
receptive field. Many locations (J>=25) trigger attention head adjustments for
proper spatial modeling.
}

\examples{
\dontrun{
# High-complexity configuration
spec <- calc_npe_spec_v5_2(
  n_sims = 12000,
  n_params = 72,
  n_timesteps = 365,
  n_locations = 18,
  flow_complexity = "high"
)

# Long sequence with auto-guards
spec_long <- calc_npe_spec_v5_2(
  n_sims = 10000,
  n_params = 50,
  n_timesteps = 900,  # Triggers long-T guard
  n_locations = 30     # Triggers large-J guard
)
}

}
