% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/calc_spatial_hazard.R
\name{calc_spatial_hazard}
\alias{calc_spatial_hazard}
\title{Calculate spatial importation hazard}
\usage{
calc_spatial_hazard(
  beta,
  tau,
  pie,
  N,
  S,
  V1_sus,
  V2_sus,
  I1,
  I2,
  time_names = NULL,
  location_names = NULL
)
}
\arguments{
\item{beta}{Numeric \strong{T × J} matrix. Human force‑of‑infection parameter
\eqn{\beta_{jt}} for each time step (\emph{rows}) and location (\emph{columns}).}

\item{tau}{Numeric vector of length \strong{J}. Reporting proportion
\eqn{\tau_j \in (0,1]} for each location.  A value of 1 means perfect
reporting; smaller values down‑weight local susceptibles and up‑weight
non‑local infections.}

\item{pie}{Numeric \strong{J × J} matrix of gravity‑model mobility weights
\eqn{\pi_{ij}} from origin \emph{i} to destination \emph{j}.  Diagonal entries are
ignored.}

\item{N}{Numeric \strong{T × J} matrix of total population \eqn{N_{jt}}.}

\item{S}{Numeric \strong{T × J} matrix of fully susceptible individuals
\eqn{S_{jt}}.}

\item{V1_sus, }{V2_sus Numeric \strong{T × J} matrices of vaccine‑derived
susceptibles after one and two doses, respectively.}

\item{I1, }{I2 Numeric \strong{T × J} matrices of symptomatic and asymptomatic
infectives.}

\item{time_names}{Optional character vector of length \strong{T} for output row
names.}

\item{location_names}{Optional character vector of length \strong{J} for output
column names.}
}
\value{
A numeric \strong{T × J} matrix \code{H} with elements in [0,1] giving the
spatial importation hazard for each time–location pair.
}
\description{
Computes the \strong{daily probability that at least one new infection is introduced}
into each destination location \emph{j} on day \emph{t} using a gravity‐style coupling of
infectious prevalence across all locations.  The formulation is adapted from
Bjørnstad & Grenfell (2008) but (i) folds the gravity weights directly into
the prevalence term instead of using a separate coupling constant, and (ii)
allows for under‑reporting through the location‐specific parameter \code{tau}.

Concretely, for time \emph{t} and destination \emph{j} the hazard is
\deqn{\mathcal H_{jt} \,=\, \frac{\beta_{jt}\,S^{\*}_{jt}
       \bigl[1-\exp\{-(S^{\*}_{jt}/N_{jt})\,\bar y_{jt}\}\bigr]}
      {1+\beta_{jt}\,S^{\*}_{jt}},}
where
\itemize{
\item \eqn{S^{\*}_{jt} = (1-\tau_j)\bigl(S_{jt}+V^{\mathrm{sus}}_{1,jt}+V^{\mathrm{sus}}_{2,jt}\bigr)} is the locally susceptible pool (adjusted for under‑reporting when \code{tau<1}).
\item \eqn{\bar y_{jt}} is the \strong{gravity‑weighted prevalence of infection} in the
entire metapopulation (including the destination):
\deqn{\bar y_{jt} = \frac{ (1-\tau_j)(I_{1,jt}+I_{2,jt}) +
        \sum_{i\neq j}\tau_i\,\pi_{ij}\,(I_{1,it}+I_{2,it}) }
       {\sum_{k} N_{kt} }.}
}

Note: This specification differs from the two‑stage form in the original
paper but has been used in later work where the mobility matrix itself
carries the full coupling strength.
}
\details{
\emph{Diagonal of} \code{pie} \emph{is set to zero internally.}  All matrices must have
matching dimensions; dimension checks throw informative errors.
}
\section{Warning}{

The current formulation intentionally \strong{includes local infectious
individuals} in \verb{\\bar y_\{jt\}}.  If you wish to model \emph{importation only},
set the local contribution to zero in the numerator.
}

\examples{
\dontrun{
set.seed(123)
T_steps <- 10; J <- 5
beta <- matrix(runif(T_steps * J), nrow = T_steps, ncol = J)
tau <- runif(J)
pie <- matrix(runif(J^2), J, J); diag(pie) <- 0
N <- matrix(sample(200:400, T_steps * J, replace = TRUE), nrow = T_steps, ncol = J)
S <- matrix(sample(100:200, T_steps * J, replace = TRUE), nrow = T_steps, ncol = J)
V1_sus <- matrix(sample(0:50, T_steps * J, replace = TRUE), nrow = T_steps, ncol = J)
V2_sus <- matrix(sample(0:50, T_steps * J, replace = TRUE), nrow = T_steps, ncol = J)
I1 <- matrix(sample(0:10, T_steps * J, replace = TRUE), nrow = T_steps, ncol = J)
I2 <- matrix(sample(0:10, T_steps * J, replace = TRUE), nrow = T_steps, ncol = J)

H <- calc_spatial_hazard(beta, tau, pie, N, S, V1_sus, V2_sus, I1, I2,
                         time_names = paste0("day_", 1:T_steps),
                         location_names = paste0("loc_", 1:J))

plot_spatial_hazard(H)
}

}
\references{
\itemize{
\item Bjørnstad, O. N., & Grenfell, B. T. (2008). \emph{Hazards, spatial transmission
and timing of outbreaks in epidemic metapopulations.} Journal of Theoretical
Ecology, 1, 145‑153.
}
}
