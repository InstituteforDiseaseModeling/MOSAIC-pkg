% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/est_initial_V1_V2_location.R
\name{est_initial_V1_V2_location}
\alias{est_initial_V1_V2_location}
\title{Estimate Initial V1 and V2 Compartments for a Location}
\usage{
est_initial_V1_V2_location(
  doses_ts,
  t0,
  N = NA,
  vacc_ceiling_frac = 0.6,
  omega1 = 0.003,
  omega2 = 0.003,
  t_lag = 14L,
  min_interdose_days = 40L,
  phi1 = 1,
  phi2 = 1
)
}
\arguments{
\item{doses_ts}{A data frame containing vaccination history with columns:
\describe{
\item{date}{Date of vaccine administration (Date or character that can be coerced to Date)}
\item{doses}{Number of doses administered on that date (numeric, positive)}
}}

\item{t0}{The target date for which to estimate V1 and V2 compartments (Date object).
Only vaccination events on or before this date are considered.}

\item{N}{Total population size for the location (numeric, positive). Used to calculate
the vaccination ceiling. Can be NA if ceiling constraint is not needed.}

\item{vacc_ceiling_frac}{Maximum fraction of population that can receive first doses
(numeric between 0 and 1). Default is 0.6 (60\% coverage ceiling).}

\item{omega1}{Waning rate for one-dose protection (numeric, positive). Units are 1/days.
Default corresponds to approximately 231-day half-life (0.003).}

\item{omega2}{Waning rate for two-dose protection (numeric, positive). Units are 1/days.
Default equals omega1 but typically should be lower (slower waning).}

\item{t_lag}{Lag time in days for vaccine protection to develop after administration
(integer, non-negative). Default is 14 days.}

\item{min_interdose_days}{Minimum number of days required between first and second doses
(integer, non-negative). Default is 40 days following WHO OCV guidelines.}

\item{phi1}{Vaccine effectiveness for one-dose regimen (proportion developing protection).
Numeric between 0 and 1. Default is 1.0 (100\% effectiveness).}

\item{phi2}{Vaccine effectiveness for two-dose regimen (proportion developing protection).
Numeric between 0 and 1. Default is 1.0 (100\% effectiveness).}
}
\value{
A named numeric vector with two elements:
\describe{
\item{V1}{Estimated number of effectively protected individuals with one-dose at time t0}
\item{V2}{Estimated number of effectively protected individuals with two-dose at time t0}
}
}
\description{
Estimates the number of individuals in the V1 (one-dose) and V2 (two-dose) vaccination
compartments at a given time point (t0) for a single location. The function tracks
vaccination cohorts through time using a FIFO (First-In-First-Out) queue system,
accounts for waning immunity via exponential decay, incorporates vaccine effectiveness,
and respects operational constraints including vaccination coverage ceilings and
minimum inter-dose intervals.
}
\details{
The function implements a sophisticated vaccine allocation algorithm that:

\strong{Cohort Tracking:}
\itemize{
\item Maintains separate cohorts for first and second doses with timestamps
\item Uses FIFO logic to allocate second doses from oldest eligible first-dose cohorts
\item Second doses decrement V1 and increment V2 (individuals move between compartments)
}

\strong{Constraint Enforcement:}
\itemize{
\item Vaccination ceiling: First doses cannot exceed \code{vacc_ceiling_frac * N}
\item Inter-dose interval: Second doses only from cohorts at least \code{min_interdose_days} old
\item No same-day second doses (enforced by inter-dose interval)
}

\strong{Allocation Priority:}
\enumerate{
\item If V1 at ceiling, prioritize second doses from eligible cohorts
\item Allocate first doses up to remaining ceiling capacity
\item Use any remaining doses for additional second doses if possible
\item Excess doses beyond all constraints are effectively lost
}

\strong{Waning Immunity:}
Final V1 and V2 estimates account for exponential decay of protection:
\deqn{V_i(t_0) = \sum_{cohorts} size_j \times exp(-\omega_i \times (t_0 - date_j - t_{lag}))}

\strong{Vaccine Effectiveness:}
The output represents effectively protected individuals, not just vaccinated:
\deqn{V1_{effective} = V1_{vaccinated} \times \phi_1}
\deqn{V2_{effective} = V2_{vaccinated} \times \phi_2}
Note: Ceiling constraints operate on administrative coverage (doses given), not effective coverage.
}
\examples{
\dontrun{
# Create sample vaccination data
doses_df <- data.frame(
  date = seq.Date(from = as.Date("2023-01-01"),
                  to = as.Date("2023-12-31"),
                  by = "month"),
  doses = c(50000, 45000, 40000, 35000, 30000, 25000,
           20000, 15000, 10000, 5000, 3000, 2000)
)

# Estimate V1 and V2 on January 1, 2024
v_compartments <- est_initial_V1_V2_location(
  doses_ts = doses_df,
  t0 = as.Date("2024-01-01"),
  N = 1000000,
  vacc_ceiling_frac = 0.6,
  omega1 = 0.003,
  omega2 = 0.0015,
  t_lag = 14,
  min_interdose_days = 40,
  phi1 = 0.65,  # 65\% one-dose effectiveness
  phi2 = 0.85   # 85\% two-dose effectiveness
)

print(v_compartments)
# V1      V2
# 80246   67074  # Lower than vaccinated due to effectiveness
}

}
\references{
WHO (2017). Cholera vaccines: WHO position paper. Weekly Epidemiological Record.
}
\seealso{
\code{\link{est_vaccination_rate}} for processing vaccination campaign data
\code{\link{est_vaccine_effectiveness}} for vaccine efficacy parameters
\code{\link{est_immune_decay_vaccine}} for waning rate estimation
}
