% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/grid_search_best_subset.R
\name{grid_search_best_subset}
\alias{grid_search_best_subset}
\title{Grid Search for Best Subset with Early Stopping}
\usage{
grid_search_best_subset(
  results,
  target_ESS,
  target_A,
  target_CVw,
  min_size,
  max_size,
  step_size = 1,
  ess_method = c("kish", "perplexity"),
  verbose = FALSE
)
}
\arguments{
\item{results}{Data frame of calibration results with columns: sim, likelihood}

\item{target_ESS}{Numeric target for Effective Sample Size (ESS)}

\item{target_A}{Numeric target for Agreement Index (A)}

\item{target_CVw}{Numeric target for Coefficient of Variation of weights (CVw)}

\item{min_size}{Integer minimum subset size to search}

\item{max_size}{Integer maximum subset size to search}

\item{step_size}{Integer step size for search (default 1)}

\item{ess_method}{Character ESS calculation method: "kish" or "perplexity"}

\item{verbose}{Logical print progress messages}
}
\value{
List with elements:
\itemize{
\item n: Optimal subset size (smallest n meeting criteria)
\item subset: Data frame of selected simulations
\item metrics: List with ESS, A, CVw values at optimal n
\item converged: Logical indicating if criteria were met
\item evaluations: Integer number of n values tested
}
}
\description{
Performs exhaustive grid search to find the smallest subset size that meets
convergence criteria (ESS, A, CVw) using Gibbs weighting. Stops at first convergence.
}
\details{
The function searches from min_size to max_size by step_size, stopping at the
first size where all three criteria are met simultaneously:
\itemize{
\item ESS >= target_ESS
\item A >= target_A
\item CVw <= target_CVw
}

Metrics are calculated using Gibbs weighting with dynamic temperature:
\enumerate{
\item Calculate AIC = -2 * likelihood for subset
\item Calculate Delta AIC (relative to best in subset)
\item Calculate dynamic temperature:
\itemize{
\item percentile = (n / n_total) * 100
\item effective_range = get_effective_aic_range(percentile)
\item actual_range = range(Delta AIC)
\item temperature = 0.5 * (effective_range / actual_range)
}
\item Apply Gibbs weighting: weights = exp(-Delta AIC / temperature) / Z
\item Calculate ESS, A, CVw from Gibbs-weighted samples
}

This exactly matches the identify_best_subset logic, ensuring consistent
weighting and convergence behavior across both search strategies.

If no size meets criteria, returns results at max_size with converged=FALSE.
}
\examples{
\dontrun{
result <- grid_search_best_subset(
  results = calibration_results,
  target_ESS = 500,
  target_A = 0.95,
  target_CVw = 0.7,
  min_size = 30,
  max_size = 1000
)
}

}
