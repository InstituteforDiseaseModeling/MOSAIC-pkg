% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/run_MOSAIC.R
\name{mosaic_control_defaults}
\alias{mosaic_control_defaults}
\title{Build Complete MOSAIC Control Structure}
\usage{
mosaic_control_defaults(
  calibration = NULL,
  sampling = NULL,
  targets = NULL,
  fine_tuning = NULL,
  npe = NULL,
  parallel = NULL,
  io = NULL,
  paths = NULL
)
}
\arguments{
\item{calibration}{List of calibration settings. Default is:
\itemize{
\item \code{n_simulations}: NULL for auto mode, or integer for fixed mode
\item \code{n_iterations}: Number of LASER iterations per simulation (default: 3L)
\item \code{max_simulations}: Maximum total simulations in auto mode (default: 100000L)
\item \code{batch_size}: Simulations per batch in calibration phase (default: 500L)
\item \code{min_batches}: Minimum calibration batches (default: 5L)
\item \code{max_batches}: Maximum calibration batches (default: 8L)
\item \code{target_r2}: RÂ² target for calibration convergence (default: 0.90)
}}

\item{sampling}{List of parameter sampling flags (what to sample). Default is:
\itemize{
\item \code{sample_tau_i}: Sample transmission rate (default: TRUE)
\item \code{sample_mobility_gamma}: Sample mobility gamma (default: TRUE)
\item \code{sample_mobility_omega}: Sample mobility omega (default: TRUE)
\item \code{sample_mu_j}: Sample recovery rate (default: TRUE)
\item \code{sample_iota}: Sample importation rate (default: TRUE)
\item \code{sample_gamma_2}: Sample second dose efficacy (default: TRUE)
\item \code{sample_alpha_1}: Sample first dose efficacy (default: FALSE)
}}

\item{targets}{List of convergence targets (when to stop). Default is:
\itemize{
\item \code{ESS_param}: Target ESS per parameter (default: 500)
\item \code{ESS_param_prop}: Proportion of parameters meeting ESS (default: 0.95)
\item \code{ESS_best}: Target ESS for best subset (default: 100)
\item \code{A_best}: Target agreement index (default: 0.95)
\item \code{CVw_best}: Target CV of weights (default: 0.5)
\item \code{B_min}: Minimum best subset size (default: 30)
\item \code{percentile_max}: Maximum percentile for best subset (default: 5.0)
}}

\item{fine_tuning}{List of fine-tuning batch sizes (advanced calibration). Default is:
\itemize{
\item \code{batch_sizes}: Named list with massive, large, standard, precision, final
}}

\item{npe}{List of NPE settings (post-calibration stage). Default is:
\itemize{
\item \code{enable}: Enable NPE training (default: FALSE)
\item \code{weight_strategy}: NPE weight strategy (default: "continuous_all")
}}

\item{parallel}{List of parallelization settings (infrastructure). Default is:
\itemize{
\item \code{enable}: Enable parallel execution (default: FALSE)
\item \code{n_cores}: Number of cores to use (default: 1L)
\item \code{type}: Cluster type, "PSOCK" or "FORK" (default: "PSOCK")
\item \code{progress}: Show progress bar (default: TRUE)
}}

\item{io}{List of I/O settings (output format). Default is:
\itemize{
\item \code{format}: Output format, "parquet" or "csv" (default: "parquet")
\item \code{compression}: Compression algorithm (default: "zstd")
\item \code{compression_level}: Compression level (default: 3L)
}}

\item{paths}{List of path and output settings (file management). Default is:
\itemize{
\item \code{clean_output}: Remove output directory if exists (default: FALSE)
\item \code{plots}: Generate diagnostic plots (default: TRUE)
}}
}
\value{
A complete control list suitable for passing to \code{run_mosaic()} or \code{run_mosaic_iso()}.
}
\description{
Creates a complete control structure for \code{run_mosaic()} and \code{run_mosaic_iso()}.
This is the primary interface for configuring MOSAIC execution settings, consolidating
calibration strategy, parameter sampling, parallelization, and output options.

\strong{Parameters are organized in workflow order:}
\enumerate{
\item \code{calibration}: How to run (simulations, iterations, batch sizes)
\item \code{sampling}: What to sample (which parameters to vary)
\item \code{targets}: When to stop (ESS convergence thresholds)
\item \code{fine_tuning}: Advanced calibration (adaptive batch sizing)
\item \code{npe}: Post-calibration stage (neural posterior estimation)
\item \code{parallel}: Infrastructure (cores, cluster type)
\item \code{io}: Output format (file format, compression)
\item \code{paths}: File management (output directories, plots)
}
}
\examples{
# Default control settings
ctrl <- mosaic_control_defaults()

# Quick parallel run with 8 cores
ctrl <- mosaic_control_defaults(
  parallel = list(enable = TRUE, n_cores = 8)
)

# Fixed mode with 5000 simulations, 5 iterations each
ctrl <- mosaic_control_defaults(
  calibration = list(
    n_simulations = 5000,
    n_iterations = 5
  )
)

# Auto mode with custom settings
ctrl <- mosaic_control_defaults(
  calibration = list(
    n_simulations = NULL,  # NULL = auto mode
    n_iterations = 3,
    max_simulations = 50000,
    batch_size = 1000
  ),
  parallel = list(enable = TRUE, n_cores = 16)
)

# Only sample specific parameters
ctrl <- mosaic_control_defaults(
  sampling = list(
    sample_tau_i = TRUE,
    sample_mobility_gamma = FALSE,
    sample_mobility_omega = FALSE,
    sample_mu_j = TRUE,
    sample_iota = FALSE,
    sample_gamma_2 = FALSE,
    sample_alpha_1 = FALSE
  )
)

# Full workflow configuration (demonstrates logical order)
ctrl <- mosaic_control_defaults(
  calibration = list(n_simulations = NULL, n_iterations = 3),  # How to run
  sampling = list(sample_tau_i = TRUE, sample_mu_j = TRUE),    # What to sample
  targets = list(ESS_param = 500, ESS_param_prop = 0.95),      # When to stop
  fine_tuning = list(batch_sizes = list(final = 200)),         # Advanced calibration
  npe = list(enable = TRUE, weight_strategy = "best_subset"),  # Post-calibration
  parallel = list(enable = TRUE, n_cores = 16),                # Infrastructure
  io = mosaic_io_presets("default"),                           # Output format
  paths = list(clean_output = FALSE, plots = TRUE)             # File management
)

}
