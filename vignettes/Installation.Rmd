---
title: "Installation"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Installation}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  eval = FALSE
)
```

## Overview

MOSAIC has two installation levels depending on your needs:

| Setup            | Purpose                                          | Requirements                   |
|:-----------------|:-------------------------------------------------|:-------------------------------|
| **Basic**        | Run models with pre-configured data              | R + internet                   |
| **Developer**    | Full access: data collection, prior estimation, development | R + git + system libraries     |

Most users should start with **Basic**.

---

## Basic Setup

Install the R package from GitHub and let it automatically set up Python dependencies. This is sufficient for running models with pre-configured parameters and data.

```{r basic-install}
# Install MOSAIC R package
devtools::install_github("InstituteforDiseaseModeling/MOSAIC-pkg")

# Load and install Python dependencies
library(MOSAIC)
install_dependencies()

# Check Python environment and dependencies
check_python_env()
check_dependencies()

# Verify installation
config <- config_default
results <- run_LASER(config, n_sim = 2, seed = 123)
```

**Successful installation output:**

When MOSAIC loads successfully, you should see:

```
 __  __   ___   ____     _     ___  ____       __      ___    _____  _____   _____ ___
|  \/  | / _ \ / ___|   / \   |_ _|/ ___|   __/ /_    / /    /   |  / ___/ / ____// __ \
| |\/| || | | |\___ \  / _ \   | || |      /_  __/   / /    / /| |  \__ \ / __/  / /_/ /
| |  | || |_| | ___) |/ ___ \  | || |___    /_/     / /___ / ___ | ___/ // /___ / _, _/
|_|  |_| \___/ |____//_/   \_\|___|\____|          /_____//_/  |_|/____//_____//_/ |_|

Welcome to the Metapopulation Outbreak Simulation with Agent-based Implementation
for Cholera (MOSAIC) featuring the Light-agent Spatial Model for ERadication (LASER)!

Version: 0.11.25
```

---

## Developer Setup

Clone the full repository structure for data processing, parameter estimation, and code development. Requires system dependencies (GDAL, PROJ, GEOS, UDUNITS).

**Note**: We recommend creating a `~/MOSAIC` directory to organize all MOSAIC repositories in one location.

### Install System Dependencies

**macOS:**
```{sh dev-macos}
brew install gdal proj geos udunits
```

**Ubuntu/Debian:**
```{sh dev-ubuntu}
sudo apt-get install -y gdal-bin libgdal-dev libproj-dev libgeos-dev libudunits2-dev
```

### Clone Repositories

```{sh dev-clone}
mkdir -p ~/MOSAIC && cd ~/MOSAIC
git clone git@github.com:InstituteforDiseaseModeling/MOSAIC-pkg.git
git clone git@github.com:InstituteforDiseaseModeling/MOSAIC-data.git
git clone git@github.com:InstituteforDiseaseModeling/MOSAIC-docs.git
git clone git@github.com:InstituteforDiseaseModeling/laser-cholera.git
git clone git@github.com:InstituteforDiseaseModeling/ees-cholera-mapping.git
```

### Install and Configure

```{r dev-install}
# Install R package from source
devtools::install("~/MOSAIC/MOSAIC-pkg")

# Set up Python and paths
library(MOSAIC)
install_dependencies()
set_root_directory("~/MOSAIC")

# Check Python environment and dependencies
check_python_env()
check_dependencies()

# Verify
PATHS <- get_paths()
config <- config_default
results <- run_LASER(config, n_sim = 2, seed = 123)
```

### Development Workflow

```{r dev-workflow}
# Load for development
devtools::load_all("~/MOSAIC/MOSAIC-pkg")

# Run tests
devtools::test()

# Build documentation
devtools::document()
pkgdown::build_site()
```

### Optional: Mobility Package

The `mobility` package is only needed if you want to regenerate mobility estimates from scratch. Most users can skip this - pre-computed mobility files are included in `model/input/`.

```{r mobility-install}
# Only install if you need to regenerate mobility data
# Requires JAGS system library

# macOS:
# brew install jags

# Ubuntu/Debian:
# sudo apt-get install -y jags libjags-dev

# Then install R packages:
install.packages("rjags")
remotes::install_github("COVID-19-Mobility-Data-Network/mobility")
```

**When is this needed?** Only if you're calling `MOSAIC::est_mobility()` to regenerate mobility matrices. Otherwise, use the pre-computed files included with the package.

---

## Troubleshooting

**Python issues:**
```{r troubleshoot-python}
# Check Python environment and dependencies
check_python_env()
check_dependencies()

# Check detailed Python configuration
reticulate::py_config()

# Reset if needed
remove_MOSAIC_python_env()
install_dependencies()
```

**Path issues (Developer only):**
```{r troubleshoot-paths}
# Check and reset root directory
getOption("root_directory")
set_root_directory("~/MOSAIC")
```

---

## Next Steps

- **Running MOSAIC**: Learn how to execute models and work with outputs
- **Deployment**: Set up MOSAIC on remote VMs or compute clusters
