---
title: "Project Setup"
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  eval = FALSE
)
```

## Overview

The MOSAIC framework consists of multiple interconnected repositories that work together. This guide walks you through setting up the complete MOSAIC development environment, including all required repositories, system dependencies, and Python/R environments.

## Repository Structure

MOSAIC is organized into several GitHub repositories, each serving a specific purpose:

### Core MOSAIC Repositories (Editable)

- **MOSAIC-pkg/**: R package containing all modeling functions, data processing tools, and analysis utilities
  - 100+ functions for parameter estimation, visualization, and model execution
  - Interfaces with Python laser-cholera package via reticulate

- **MOSAIC-data/**: Data repository with raw and processed data
  - `raw/`: Original data sources (local only, read-only)
  - `processed/`: Cleaned and prepared data ready for modeling

- **MOSAIC-docs/**: Documentation website and project documentation
  - Built with pkgdown and bookdown
  - Figure outputs from analysis
  - Published to GitHub Pages

### External Dependencies (Read-Only)

- **laser-cholera/**: Core LASER simulation engine (Python)
  - Metapopulation cholera transmission model
  - Numba-optimized for performance
  - Not directly edited, installed as Python package

- **ees-cholera-mapping/**: Web scraping tools for cholera surveillance data
  - Automated data collection from WHO and other sources

## System Requirements

### Required System Dependencies

MOSAIC requires several system libraries for geospatial operations:

#### macOS (using Homebrew)

```{sh install-macos, eval=FALSE}
# Install geospatial libraries
brew install gdal proj geos udunits

# Install JAGS (optional - only if using mobility package)
brew install jags
```

#### Ubuntu/Debian

```{sh install-ubuntu, eval=FALSE}
# Install geospatial libraries
sudo apt-get update
sudo apt-get install -y \
  gdal-bin \
  libgdal-dev \
  libproj-dev \
  libgeos-dev \
  libudunits2-dev

# Install JAGS (optional - only if using mobility package)
sudo apt-get install -y jags
```

#### Windows

For Windows users, install [OSGeo4W](https://trac.osgeo.org/osgeo4w/) which provides GDAL, PROJ, and GEOS.

### Python Requirements

MOSAIC requires Python 3.9 or higher:

```{sh check-python, eval=FALSE}
# Check Python version
python3 --version  # Should be 3.9 or higher
```

## Installation Steps

### Step 1: Clone Repositories

Use this bash script to programmatically set up the MOSAIC project directory:

```{sh clone-repos, eval=FALSE}
#!/bin/bash

# Set the MOSAIC parent directory
MOSAIC_DIR="MOSAIC"

# Create the MOSAIC directory if it doesn't exist
if [ ! -d "$MOSAIC_DIR" ]; then
    mkdir "$MOSAIC_DIR"
    echo "Created directory: $MOSAIC_DIR"
fi

# Change to the MOSAIC directory
cd "$MOSAIC_DIR"

# Function to clone or update a repository
clone_or_update_repo() {
    REPO_NAME=$1
    REPO_URL=$2

    if [ ! -d "$REPO_NAME" ]; then
        git clone "$REPO_URL"
        echo "Cloned $REPO_NAME repository."
    else
        echo "$REPO_NAME repository already exists. Pulling latest changes."
        cd "$REPO_NAME"
        git pull
        cd ..
    fi
}

# Clone or update the MOSAIC repositories
clone_or_update_repo "MOSAIC-data" "git@github.com:InstituteforDiseaseModeling/MOSAIC-data.git"
clone_or_update_repo "MOSAIC-pkg" "git@github.com:InstituteforDiseaseModeling/MOSAIC-pkg.git"
clone_or_update_repo "MOSAIC-docs" "git@github.com:InstituteforDiseaseModeling/MOSAIC-docs.git"

# Clone external dependencies (read-only)
clone_or_update_repo "laser-cholera" "git@github.com:InstituteforDiseaseModeling/laser-cholera.git"
clone_or_update_repo "ees-cholera-mapping" "git@github.com:InstituteforDiseaseModeling/ees-cholera-mapping.git"

echo "MOSAIC project setup complete."
```

Save this as `setup_mosaic.sh`, make it executable, and run it:

```{sh run-setup, eval=FALSE}
chmod +x setup_mosaic.sh
./setup_mosaic.sh
```

### Step 2: Install Python Environment

The MOSAIC R package can automatically set up the Python environment:

#### Option A: Automatic Installation (Recommended)

```{r python-auto, eval=FALSE}
# Install MOSAIC R package first
devtools::install_github("InstituteforDiseaseModeling/MOSAIC-pkg")

# Load package
library(MOSAIC)

# Check what's missing
check_dependencies()

# Install Python dependencies automatically
install_dependencies()
```

This will:
- Create a Python virtual environment
- Install laser-cholera and all dependencies
- Configure reticulate to use this environment

#### Option B: Manual Python Installation

If you prefer manual control:

```{sh python-manual, eval=FALSE}
# Navigate to laser-cholera repository
cd MOSAIC/laser-cholera

# Create virtual environment
python3 -m venv venv

# Activate environment
source venv/bin/activate  # macOS/Linux
# or: venv\Scripts\activate  # Windows

# Install laser-cholera in editable mode
pip install -e .

# Verify installation
python -c "import laser_cholera; print(laser_cholera.__version__)"
```

### Step 3: Install R Package

Install the MOSAIC R package with all dependencies:

```{r install-r, eval=FALSE}
# Install from GitHub
devtools::install_github("InstituteforDiseaseModeling/MOSAIC-pkg",
                         dependencies = TRUE)

# Load the package
library(MOSAIC)

# Verify installation
packageVersion("MOSAIC")
```

### Step 4: Set Root Directory

The MOSAIC package needs to know where your project root is:

```{r set-root, eval=FALSE}
# Set root to parent directory containing all repos
set_root_directory("~/path/to/MOSAIC")

# Get paths to all data and output directories
PATHS <- get_paths()

# View available paths
names(PATHS)
```

## Verifying Installation

### Check All Dependencies

```{r verify, eval=FALSE}
library(MOSAIC)

# Check Python and laser-cholera
check_dependencies()

# Test a simple model run
config <- config_default
results <- run_LASER(config, n_sim = 2, seed = 123)

# If this completes without errors, you're ready to go!
```

### Troubleshooting

If you encounter issues:

```{r troubleshoot, eval=FALSE}
# Check reticulate Python configuration
reticulate::py_config()

# Check if laser-cholera is importable
reticulate::py_module_available("laser_cholera")

# Reset Python environment if needed
remove_MOSAIC_python_env()
install_dependencies()
```

## Directory Structure

After setup, your directory structure should look like:

```
MOSAIC/
├── MOSAIC-pkg/          # R package (main working directory)
│   ├── R/               # Function definitions
│   ├── data/            # Package data
│   ├── model/           # LAUNCH.R and input/output
│   ├── tests/           # Unit tests
│   └── vignettes/       # Documentation
├── MOSAIC-data/
│   ├── raw/             # Raw data (read-only)
│   └── processed/       # Processed data
├── MOSAIC-docs/
│   └── figures/         # Documentation figures
├── laser-cholera/       # Python simulation engine
└── ees-cholera-mapping/ # Data scraping tools
```

## Optional: Mobility Package

The `mobility` package is optional and only needed if regenerating mobility estimates:

```{r install-mobility, eval=FALSE}
# Install JAGS first (system dependency - see above)

# Install mobility from GitHub
remotes::install_github("COVID-19-Mobility-Data-Network/mobility")

# Most users don't need this - pre-computed mobility files are included
```

## Next Steps

Now that your environment is set up:

1. **Run your first model**: See the "Running MOSAIC" vignette
2. **Explore data processing**: Check `process_*` functions
3. **Parameter estimation**: Explore `est_*` functions
4. **Read the documentation**: Visit https://institutefordiseasemodeling.github.io/MOSAIC-pkg/

## Getting Help

- Check Python environment: `reticulate::py_config()`
- Check dependencies: `MOSAIC::check_dependencies()`
- Report issues: https://github.com/InstituteforDiseaseModeling/MOSAIC-pkg/issues
- Function documentation: `?function_name`
